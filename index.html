<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>English Learning App</title>

<!-- ðŸ”¹ KEEP YOUR EXISTING CSS EXACTLY AS IS -->
<!-- (UNCHANGED FROM CODE 2 â€“ NOT REPEATED HERE TO SAVE SPACE) -->

</head>
<body>

<div class="container">

<!-- ================= PROFILE SCREEN ================= -->
<div id="profile-screen" class="profile-screen">
  <div class="profile-header">
    <h1>ðŸ“š English Learning</h1>
    <p>Select a profile or create a new one</p>
  </div>

  <div class="profiles-list" id="profiles-list"></div>

  <button class="add-profile-btn" onclick="showCreateProfileModal()">
    âž• Create New Profile
  </button>
</div>

<!-- ================= MAIN APP ================= -->
<div id="main-app" class="main-app">
  <div class="header">
    <div class="header-top">
      <h1>ðŸ“š English Learning</h1>
      <div class="profile-info">
        ðŸ‘¤ <span id="current-profile-name"></span>
        <button class="logout-btn" onclick="logout()">Logout</button>
      </div>
    </div>

    <div class="tabs">
      <button class="tab active" onclick="switchTab('words')">Words</button>
      <button class="tab" onclick="switchTab('sentences')">Sentences</button>
      <button class="tab" onclick="switchTab('courses')">Courses</button>
      <button class="tab" onclick="switchTab('study')">Study</button>
    </div>
  </div>

  <!-- CONTENT SECTIONS (UNCHANGED UI) -->
  <div id="words-section" class="content-section active">
    <form onsubmit="addWord(event)">
      <input id="word-input" placeholder="Word" required>
      <textarea id="word-meaning" placeholder="Meaning" required></textarea>
      <textarea id="word-example" placeholder="Example"></textarea>
      <select id="word-course"></select>
      <button>Add Word</button>
    </form>
    <div id="words-list"></div>
  </div>

  <div id="sentences-section" class="content-section">
    <form onsubmit="addSentence(event)">
      <textarea id="sentence-input" required></textarea>
      <textarea id="sentence-notes"></textarea>
      <select id="sentence-course"></select>
      <button>Add Sentence</button>
    </form>
    <div id="sentences-list"></div>
  </div>

  <div id="courses-section" class="content-section">
    <form onsubmit="addCourse(event)">
      <input id="course-name" required>
      <textarea id="course-description"></textarea>
      <button>Add Course</button>
    </form>
    <div id="courses-list"></div>
  </div>

  <div id="study-section" class="content-section">
    <select id="study-filter" onchange="renderStudyList()"></select>
    <select id="study-sort" onchange="renderStudyList()">
      <option value="newest">Newest</option>
      <option value="oldest">Oldest</option>
      <option value="alphabetical">Aâ€“Z</option>
    </select>
    <div id="study-list"></div>
  </div>
</div>

</div>

<!-- ================= MODALS (UNCHANGED UI) ================= -->
<div id="create-profile-modal" class="modal">
  <div class="modal-content">
    <input id="new-profile-name" placeholder="Profile Name">
    <input id="new-profile-pin" placeholder="4-digit PIN" maxlength="4">
    <button onclick="createProfile()">Create</button>
    <button onclick="closeCreateProfileModal()">Cancel</button>
  </div>
</div>

<div id="pin-modal" class="modal">
  <div class="modal-content">
    <h3 id="pin-profile-name"></h3>
    <input id="enter-pin" maxlength="4">
    <button onclick="verifyPin()">Enter</button>
    <button onclick="closePinModal()">Cancel</button>
  </div>
</div>

<!-- ================= FIREBASE ================= -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore, collection, addDoc, getDocs, getDoc, deleteDoc,
  doc, query, where, orderBy, onSnapshot
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCt522OjKEuh7BMKoX2_yIvgy66dXs2DxI",
  authDomain: "english-learning-app-d6326.firebaseapp.com",
  projectId: "english-learning-app-d6326",
  storageBucket: "english-learning-app-d6326.firebasestorage.app",
  messagingSenderId: "80639036133",
  appId: "1:80639036133:web:f4284c24bb1ee95e7de20c"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

window.fs = { db, collection, addDoc, getDocs, getDoc, deleteDoc, doc, query, where, orderBy, onSnapshot };
</script>

<!-- ================= APP LOGIC ================= -->
<script>
let profiles = [];
let currentProfile = null;
let selectedProfile = null;
let words = [];
let sentences = [];
let courses = [];

/* ---------- PROFILES ---------- */
async function loadProfiles() {
  const snap = await fs.getDocs(fs.collection(fs.db, 'profiles'));
  profiles = snap.docs.map(d => ({ id: d.id, ...d.data() }));
  document.getElementById('profiles-list').innerHTML =
    profiles.map(p => `<div onclick="selectProfile('${p.id}')">${p.name}</div>`).join('');
}

function showCreateProfileModal() {
  document.getElementById('create-profile-modal').classList.add('active');
}

function closeCreateProfileModal() {
  document.getElementById('create-profile-modal').classList.remove('active');
}

async function createProfile() {
  await fs.addDoc(fs.collection(fs.db, 'profiles'), {
    name: newProfileName.value,
    pin: newProfilePin.value,
    createdAt: Date.now()
  });
  closeCreateProfileModal();
  loadProfiles();
}

function selectProfile(id) {
  selectedProfile = profiles.find(p => p.id === id);
  pinProfileName.textContent = selectedProfile.name;
  pinModal.classList.add('active');
}

function closePinModal() {
  pinModal.classList.remove('active');
}

function verifyPin() {
  if (enterPin.value === selectedProfile.pin) {
    currentProfile = selectedProfile;
    login();
  } else alert('Wrong PIN');
}

function login() {
  pinModal.classList.remove('active');
  profileScreen.style.display = 'none';
  mainApp.classList.add('active');
  currentProfileName.textContent = currentProfile.name;
  listenData();
}

function logout() {
  currentProfile = null;
  mainApp.classList.remove('active');
  profileScreen.style.display = 'flex';
}

/* ---------- FIRESTORE LISTENERS ---------- */
function listenData() {
  fs.onSnapshot(
    fs.query(fs.collection(fs.db,'words'), fs.where('profileId','==',currentProfile.id)),
    s => { words = s.docs.map(d=>({id:d.id,...d.data()})); renderWords(); renderStudyList(); }
  );

  fs.onSnapshot(
    fs.query(fs.collection(fs.db,'sentences'), fs.where('profileId','==',currentProfile.id)),
    s => { sentences = s.docs.map(d=>({id:d.id,...d.data()})); renderSentences(); }
  );

  fs.onSnapshot(
    fs.query(fs.collection(fs.db,'courses'), fs.where('profileId','==',currentProfile.id)),
    s => { courses = s.docs.map(d=>({id:d.id,...d.data()})); updateCourseSelects(); renderCourses(); }
  );
}

/* ---------- ADD DATA ---------- */
async function addWord(e){
  e.preventDefault();
  await fs.addDoc(fs.collection(fs.db,'words'),{
    profileId: currentProfile.id,
    word: wordInput.value,
    meaning: wordMeaning.value,
    example: wordExample.value,
    course: wordCourse.value,
    timestamp: Date.now()
  });
  e.target.reset();
}

async function addSentence(e){
  e.preventDefault();
  await fs.addDoc(fs.collection(fs.db,'sentences'),{
    profileId: currentProfile.id,
    sentence: sentenceInput.value,
    notes: sentenceNotes.value,
    course: sentenceCourse.value,
    timestamp: Date.now()
  });
  e.target.reset();
}

async function addCourse(e){
  e.preventDefault();
  await fs.addDoc(fs.collection(fs.db,'courses'),{
    profileId: currentProfile.id,
    name: courseName.value,
    description: courseDescription.value,
    timestamp: Date.now()
  });
  e.target.reset();
}

/* ---------- INIT ---------- */
loadProfiles();
</script>

</body>
</html>
