<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Learning - Ultimate Cloud Sync</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <style>
        /* --- Styles remains same as your original design for consistency --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: white; min-height: 100vh; padding: 20px;
        }
        .container { max-width: 600px; margin: 0 auto; }
        
        /* Profile Screen */
        #profile-screen { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 80vh; }
        .profiles-list { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; width: 100%; margin: 20px 0; }
        .profile-card { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 15px; padding: 20px; text-align: center; cursor: pointer; transition: 0.3s; }
        .profile-card:hover { background: rgba(0,212,255,0.1); border-color: #00d4ff; }
        
        /* Main App */
        .main-app { display: none; }
        .active { display: block !important; }
        .header { background: rgba(30,30,46,0.9); padding: 20px; border-radius: 20px; margin-bottom: 20px; }
        .tabs { display: flex; gap: 10px; margin-top: 15px; }
        .tab { flex: 1; padding: 10px; border: none; border-radius: 10px; background: #2d2d44; color: #a0aec0; cursor: pointer; }
        .tab.active { background: #00d4ff; color: white; }
        
        /* Forms & Inputs */
        input, textarea, select { width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 10px; border: 1px solid #333; background: #0f172a; color: white; }
        .btn-primary { background: #00d4ff; color: white; border: none; padding: 15px; border-radius: 10px; width: 100%; font-weight: bold; cursor: pointer; }
        
        /* Modal */
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); align-items: center; justify-content: center; z-index: 100; }
        .modal-content { background: #1e1e2e; padding: 30px; border-radius: 20px; width: 90%; max-width: 400px; }
    </style>
</head>
<body>

<div class="container">
    <div id="profile-screen">
        <h1 style="margin-bottom: 10px;">Select Profile</h1>
        <p style="color: #a0aec0;">Data is synced to Cloud ‚òÅÔ∏è</p>
        <div id="profiles-list" class="profiles-list"></div>
        <button class="btn-primary" onclick="openModal('create-modal')">‚ûï Create New Profile</button>
    </div>

    <div id="main-app" class="main-app">
        <div class="header">
            <div style="display: flex; justify-content: space-between;">
                <h2 id="welcome-msg">Hi!</h2>
                <button onclick="logout()" style="background:none; border:none; color:#ff5252; cursor:pointer;">Logout</button>
            </div>
            <div class="tabs">
                <button class="tab active" onclick="showTab('words')">Words</button>
                <button class="tab" onclick="showTab('sentences')">Sentences</button>
                <button class="tab" onclick="showTab('study')">Study</button>
            </div>
        </div>

        <div id="words-tab" class="content-tab active">
            <form onsubmit="addWord(event)">
                <input type="text" id="w-input" placeholder="New Word" required>
                <input type="text" id="m-input" placeholder="Meaning" required>
                <button class="btn-primary">Save to Cloud</button>
            </form>
            <div id="words-display" style="margin-top: 20px;"></div>
        </div>
        
        <div id="sentences-tab" class="content-tab" style="display:none;">
            <form onsubmit="addSentence(event)">
                <textarea id="s-input" placeholder="Enter Sentence" required></textarea>
                <button class="btn-primary">Save Sentence</button>
            </form>
            <div id="sentences-display" style="margin-top: 20px;"></div>
        </div>

        <div id="study-tab" class="content-tab" style="display:none;">
            <div id="study-display"></div>
        </div>
    </div>
</div>

<div id="create-modal" class="modal">
    <div class="modal-content">
        <h3>Create Profile</h3><br>
        <input type="text" id="new-name" placeholder="Name">
        <input type="tel" id="new-pin" placeholder="4-Digit PIN" maxlength="4">
        <button class="btn-primary" onclick="createProfile()">Create & Sync</button>
        <button onclick="closeModal('create-modal')" style="background:none; color:gray; border:none; width:100%; margin-top:10px;">Cancel</button>
    </div>
</div>

<div id="pin-modal" class="modal">
    <div class="modal-content">
        <h3>Enter PIN</h3><br>
        <input type="tel" id="login-pin" placeholder="****" maxlength="4" style="text-align:center; font-size:24px;">
        <button class="btn-primary" onclick="verifyPin()">Unlock</button>
        <button onclick="closeModal('pin-modal')" style="background:none; color:gray; border:none; width:100%; margin-top:10px;">Cancel</button>
    </div>
</div>

<script>
    // --- FIREBASE SETUP ---
    const firebaseConfig = {

¬† apiKey: "AIzaSyCt522OjKEuh7BMKoX2_yIvgy66dXs2DxI",

¬† authDomain: "english-learning-app-d6326.firebaseapp.com",

¬† projectId: "english-learning-app-d6326",

¬† storageBucket: "english-learning-app-d6326.firebasestorage.app",

¬† messagingSenderId: "80639036133",

¬† appId: "1:80639036133:web:f4284c24bb1ee95e7de20c",

¬† measurementId: "G-VVWYDWEK6R"

};

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // --- APP STATE ---
    let allData = {};
    let currentUser = localStorage.getItem('activeUserId') || null;
    let selectedId = null;

    // --- INITIALIZATION ---
    function init() {
        db.ref('app_data').on('value', (snapshot) => {
            allData = snapshot.val() || {};
            renderProfiles();
            
            // Check if user was already logged in
            if (currentUser && allData[currentUser]) {
                showMainApp();
            } else {
                showProfileScreen();
            }
        });
    }

    // --- PROFILE ACTIONS ---
    function createProfile() {
        const name = document.getElementById('new-name').value;
        const pin = document.getElementById('new-pin').value;
        if (!name || pin.length !== 4) return alert("Invalid Input");

        const id = "user_" + Date.now();
        db.ref('app_data/' + id).set({
            id: id, name: name, pin: pin,
            words: [], sentences: []
        });
        closeModal('create-modal');
    }

    function verifyPin() {
        const pin = document.getElementById('login-pin').value;
        if (allData[selectedId].pin === pin) {
            currentUser = selectedId;
            localStorage.setItem('activeUserId', currentUser);
            showMainApp();
            closeModal('pin-modal');
        } else {
            alert("Wrong PIN!");
        }
    }

    // --- DATA ACTIONS ---
    function addWord(e) {
        e.preventDefault();
        const word = {
            id: Date.now(),
            text: document.getElementById('w-input').value,
            meaning: document.getElementById('m-input').value
        };
        const words = allData[currentUser].words || [];
        words.unshift(word);
        db.ref(`app_data/${currentUser}/words`).set(words);
        e.target.reset();
    }

    function addSentence(e) {
        e.preventDefault();
        const sentence = {
            id: Date.now(),
            text: document.getElementById('s-input').value
        };
        const sentences = allData[currentUser].sentences || [];
        sentences.unshift(sentence);
        db.ref(`app_data/${currentUser}/sentences`).set(sentences);
        e.target.reset();
    }

    // --- UI RENDERING ---
    function renderProfiles() {
        const list = document.getElementById('profiles-list');
        list.innerHTML = Object.values(allData).map(p => `
            <div class="profile-card" onclick="promptPin('${p.id}')">
                <div style="font-size:30px">üë§</div>
                <div style="font-weight:bold">${p.name}</div>
            </div>
        `).join('');
    }

    function showMainApp() {
        const user = allData[currentUser];
        document.getElementById('welcome-msg').innerText = "Hi, " + user.name;
        document.getElementById('profile-screen').style.display = 'none';
        document.getElementById('main-app').classList.add('active');
        
        // Render Words
        const words = user.words || [];
        document.getElementById('words-display').innerHTML = words.map(w => `
            <div style="background:#2d2d44; padding:15px; border-radius:10px; margin-bottom:10px;">
                <b>${w.text}</b>: ${w.meaning}
            </div>
        `).join('');

        // Render Sentences
        const sents = user.sentences || [];
        document.getElementById('sentences-display').innerHTML = sents.map(s => `
            <div style="background:#2d2d44; padding:15px; border-radius:10px; margin-bottom:10px;">${s.text}</div>
        `).join('');

        // Study View
        document.getElementById('study-display').innerHTML = `<h3>Total Items: ${words.length + sents.length}</h3>`;
    }

    function showProfileScreen() {
        document.getElementById('profile-screen').style.display = 'flex';
        document.getElementById('main-app').classList.remove('active');
    }

    function logout() {
        localStorage.removeItem('activeUserId');
        currentUser = null;
        showProfileScreen();
    }

    // --- HELPERS ---
    function showTab(tabName) {
        document.querySelectorAll('.content-tab').forEach(t => t.style.display = 'none');
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById(tabName + '-tab').style.display = 'block';
        event.target.classList.add('active');
    }
    function promptPin(id) { selectedId = id; openModal('pin-modal'); }
    function openModal(id) { document.getElementById(id).style.display = 'flex'; }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }

    init();
</script>
</body>
</html>
